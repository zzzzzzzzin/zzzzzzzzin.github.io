<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë¯¸ë¯¸ë³´ì¹´ â€” ì˜¤í”„ë¼ì¸ ë‹¨ì–´ ì‹œí—˜</title>
<style>
body { font-family: 'Pretendard', sans-serif; background:#f8fafc; color:#111; padding:20px }
h1 { text-align:center; margin-bottom:10px }
.meta { text-align:center; color:#555; margin-bottom:20px }
.quiz { max-width:960px; margin:0 auto }
.question { background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08); padding:14px 18px; margin-bottom:16px }
.question h3 { margin:0 0 10px 0 }
.options button { display:block; width:100%; text-align:left; background:#f1f5f9; border:none; padding:10px; border-radius:8px; margin-bottom:8px; cursor:pointer; transition:0.12s; font-size:15px }
.options button:hover { background:#e2e8f0 }
.options button.correct { background:#bbf7d0 }
.options button.wrong { background:#fecaca }
.options button.skip { background:#fef3c7 }
.controls { text-align:center; margin-top:12px }
.controls button { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; margin:0 6px }
#summary { background:#fff; max-width:960px; margin:20px auto; padding:14px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08) }
</style>
</head>
<body>
  <h1>ìˆ˜ëŠ¥ ì–¼ë§ˆ ì•ˆ ë‚¨ì•˜ë‹¤ í˜ë‚´ë³´ì</h1>
  <div class="meta">ë¯¸ë¯¸ë³´ì¹´ í˜•ì‹ â€” words.json ë¶ˆëŸ¬ì™€ì„œ 4ì§€ì„ ë‹¤ í€´ì¦ˆ</div>

  <div style="text-align:center;margin-bottom:20px;">
    <input type="file" id="fileInput" accept=".json" />
    <br><br>
    <input id="rangeStart" type="number" placeholder="ì‹œì‘ ë²ˆí˜¸" style="width:90px;padding:4px;"> ~
    <input id="rangeEnd" type="number" placeholder="ë ë²ˆí˜¸" style="width:90px;padding:4px;">
    <button onclick="startQuiz()">ì‹œí—˜ ì‹œì‘</button>
  </div>

  <div class="quiz" id="quiz"></div>
  <div id="results"></div>
  <div class="controls" id="controls" style="display:none">
    <button id="downloadCsv">ì˜¤ë‹µÂ·ëª¨ë¦„ CSV ë‹¤ìš´ë¡œë“œ</button>
    <button onclick="location.reload()">ë‹¤ì‹œ í’€ê¸°</button>
  </div>
  <div id="summary" style="display:none"></div>

<script>
let wordsData = [];
let wrong = new Set(), skipped = new Set(), answered = 0, total = 0;

document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
  const reader = new FileReader();
  reader.onload = function(ev) {
    try {
      wordsData = JSON.parse(ev.target.result);
      alert(`âœ… ${wordsData.length}ê°œì˜ ë‹¨ì–´ê°€ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.`);
    } catch {
      alert('âš ï¸ JSON íŒŒì¼ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };
  reader.readAsText(file, 'utf-8');
});

function startQuiz(){
  if (!wordsData.length) return alert('ë¨¼ì € words.json íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”!');
  const start = parseInt(document.getElementById('rangeStart').value || 1);
  const end = parseInt(document.getElementById('rangeEnd').value || wordsData.length);
  const data = wordsData.slice(start-1, end);
  total = data.length;
  document.getElementById('quiz').innerHTML = '';
  wrong.clear(); skipped.clear(); answered = 0;
  loadQuestions(data);
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function loadQuestions(words){
  const quiz = document.getElementById('quiz');
  words.forEach((item,idx)=>{
    const div=document.createElement('div');
    div.className='question';
    div.innerHTML=`<h3>${idx+1}. ${item.word}</h3>`;
    const opts=document.createElement('div');
    opts.className='options';
    const correct=item.meaning;
    const pool = shuffle(words.map(d=>d.meaning).filter(m=>m!==correct)).slice(0,3);
    const options=shuffle([correct,...pool]);
    options.forEach(opt=>{
      const b=document.createElement('button'); b.textContent=opt;
      b.onclick=()=>{
        [...opts.querySelectorAll('button')].forEach(bb=>bb.disabled=true);
        if(opt===correct){ b.classList.add('correct'); } else { b.classList.add('wrong'); wrong.add(item.word); }
        const p=document.createElement('p'); p.textContent='ì •ë‹µ: '+correct; p.style.marginTop='8px'; div.appendChild(p);
        answered++; checkEnd(words);
      };
      opts.appendChild(b);
    });
    const skip=document.createElement('button');
    skip.textContent='ëª¨ë¥´ê² ë‹¤';
    skip.onclick=()=>{
      [...opts.querySelectorAll('button')].forEach(bb=>bb.disabled=true);
      skip.classList.add('skip');
      skipped.add(item.word);
      const p=document.createElement('p'); p.textContent='ì •ë‹µ: '+correct; p.style.marginTop='8px'; div.appendChild(p);
      answered++; checkEnd(words);
    };
    opts.appendChild(skip);
    div.appendChild(opts);
    quiz.appendChild(div);
  });
}

function checkEnd(words){
  if(answered>=total){
    const wrongList = Array.from(wrong);
    const skipList = Array.from(skipped);
    document.getElementById('results').innerHTML =
      `<h2>ì‹œí—˜ ì™„ë£Œ ğŸ¯</h2><p>í‹€ë¦° ë‹¨ì–´: ${wrongList.length||'ì—†ìŒ'}</p><p>ëª¨ë¥´ê² ë‹¤ë¡œ í‘œì‹œí•œ ë‹¨ì–´: ${skipList.length||'ì—†ìŒ'}</p>`;
    document.getElementById('controls').style.display='block';
    const s=document.getElementById('summary');
    let html='<h3>ì˜¤ë‹µ ë° ëª¨ë¦„ ì •ë¦¬</h3>';
    if(wrongList.length) html+='<strong>í‹€ë¦° ë‹¨ì–´</strong><ul>'+wrongList.map(w=>{
      const m=words.find(x=>x.word===w).meaning; return `<li>${w} â€” ${m}</li>`;
    }).join('')+'</ul>';
    if(skipList.length) html+='<strong>ëª¨ë¥´ê² ë‹¤ ë‹¨ì–´</strong><ul>'+skipList.map(w=>{
      const m=words.find(x=>x.word===w).meaning; return `<li>${w} â€” ${m}</li>`;
    }).join('')+'</ul>';
    s.innerHTML=html; s.style.display='block';
  }
}

document.getElementById('downloadCsv').onclick=function(){
  const rows=[['type','word','meaning']];
  wrong.forEach(w=>{
    const m=wordsData.find(x=>x.word===w).meaning; rows.push(['wrong',w,m]);
  });
  skipped.forEach(w=>{
    const m=wordsData.find(x=>x.word===w).meaning; rows.push(['skip',w,m]);
  });
  const csv=rows.map(r=>r.map(c=>`"${c.replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download='ì˜¤ë‹µ_ëª¨ë¦„.csv';
  a.click();
  URL.revokeObjectURL(url);
};
</script>
</body>
</html>
